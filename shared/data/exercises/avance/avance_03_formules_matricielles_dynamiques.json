{
    "id": "avance_03_formules_matricielles_dynamiques",
    "titre": "Formules Matricielles Dynamiques : FILTER, SORT, UNIQUE",
    "niveau": "avance",
    "duree_estimee": "35 min",
    "competences": ["Formules matricielles", "FILTER", "SORT", "UNIQUE", "Tableaux dynamiques"],
    "competence_ids": [29, 39],
  
    "contexte": {
      "situation": "Tu es data analyst chez SportMax, un r√©seau de magasins de sport. Le directeur marketing veut des listes dynamiques qui se mettent √† jour automatiquement : clients par r√©gion, top ventes, produits uniques... Sans tableaux crois√©s dynamiques, juste des formules qui cr√©ent des tableaux automatiquement.",
      "manager": {
        "nom": "Alexandre Moreau",
        "poste": "Directeur Marketing",
        "personnalite": "Data-driven, il veut des dashboards qui s'actualisent en temps r√©el.",
        "demande": "Je veux des listes qui se mettent √† jour toutes seules quand on ajoute des donn√©es. Par exemple, la liste des clients de Paris, tri√©e par CA d√©croissant. C'est possible sans VBA ?"
      },
      "enjeux": "Dashboard temps r√©el pour le CODIR hebdomadaire.",
      "deadline": "Prototype pour la r√©union de mardi"
    },
  
    "objectifs": [
      "Comprendre les formules matricielles dynamiques (Excel 365)",
      "Utiliser FILTER pour extraire des donn√©es selon crit√®res",
      "Utiliser SORT pour trier automatiquement",
      "Utiliser UNIQUE pour extraire les valeurs distinctes",
      "Combiner ces fonctions pour des analyses puissantes"
    ],
  
    "prerequis_version": {
      "minimum": "Excel 365 (Microsoft 365)",
      "note": "Ces fonctions n'existent pas dans Excel 2019 et versions ant√©rieures"
    },
  
    "consignes": [
      "Ouvre le fichier avec les donn√©es de ventes",
      "Cr√©e une liste filtr√©e des clients d'une r√©gion sp√©cifique",
      "Trie automatiquement les r√©sultats par CA d√©croissant",
      "Extrais la liste des r√©gions uniques",
      "Combine les fonctions pour des analyses avanc√©es"
    ],
  
    "donnees": {
      "feuille": "Ventes",
      "table_ventes": {
        "headers": ["ID_Client", "Nom", "R√©gion", "Cat√©gorie", "CA_Annuel", "Nb_Commandes"],
        "rows": [
          ["CL001", "Dupont Sport", "Paris", "Premium", 125000, 45],
          ["CL002", "FitZone", "Lyon", "Standard", 78000, 32],
          ["CL003", "RunParis", "Paris", "Premium", 98000, 38],
          ["CL004", "V√©loMax", "Marseille", "Standard", 45000, 22],
          ["CL005", "GymTonic", "Paris", "Standard", 67000, 28],
          ["CL006", "SportLyon", "Lyon", "Premium", 112000, 42],
          ["CL007", "AquaFit", "Bordeaux", "Standard", 34000, 15],
          ["CL008", "MontagnePro", "Lyon", "Premium", 89000, 35],
          ["CL009", "BeachSport", "Marseille", "Standard", 52000, 24],
          ["CL010", "ParisGym", "Paris", "Standard", 73000, 30],
          ["CL011", "LyonFit", "Lyon", "Standard", 61000, 26],
          ["CL012", "MarseilleSport", "Marseille", "Premium", 95000, 37]
        ],
        "position": "A1:F13"
      },
      "zones_resultats": {
        "filter_simple": "I2",
        "filter_multiple": "I10",
        "sort_simple": "I18",
        "unique_regions": "I26",
        "combine_avance": "I32"
      }
    },
  
    "etapes": [
      {
        "phase": "A. Introduction aux tableaux dynamiques",
        "explications": [
          "Les formules matricielles renvoient PLUSIEURS valeurs √† la fois",
          "Le r√©sultat 'd√©borde' automatiquement dans les cellules adjacentes",
          "Pas besoin de Ctrl+Maj+Entr√©e en Excel 365 (ancienne m√©thode)",
          "Les cellules de d√©bordement sont li√©es √† la formule d'origine"
        ],
        "symbole": "Le symbole # (spill reference) permet de r√©f√©rencer tout le tableau dynamique"
      },
      {
        "phase": "B. FILTER - Filtrer selon crit√®res",
        "syntaxe": "=FILTER(tableau; condition; [si_vide])",
        "arguments": [
          "tableau : les donn√©es √† filtrer",
          "condition : crit√®re bool√©en (renvoie VRAI/FAUX pour chaque ligne)",
          "si_vide : valeur √† afficher si aucun r√©sultat (optionnel)"
        ],
        "exemple": "=FILTER(A2:F13;C2:C13=\"Paris\";\"Aucun r√©sultat\")"
      },
      {
        "phase": "C. Filtrage simple par r√©gion",
        "consignes": [
          "En I2, filtre pour afficher uniquement les clients de Paris",
          "=FILTER(A2:F13;C2:C13=\"Paris\")",
          "Le tableau s'√©tend automatiquement vers le bas"
        ]
      },
      {
        "phase": "D. SORT - Trier automatiquement",
        "syntaxe": "=SORT(tableau; [n¬∞_colonne]; [ordre]; [par_colonne])",
        "arguments": [
          "tableau : donn√©es √† trier",
          "n¬∞_colonne : quelle colonne pour le tri (d√©faut=1)",
          "ordre : 1=croissant (d√©faut), -1=d√©croissant",
          "par_colonne : FAUX=tri par lignes (d√©faut), VRAI=tri par colonnes"
        ],
        "exemple": "=SORT(A2:F13;5;-1) ‚Üí trie par CA d√©croissant"
      },
      {
        "phase": "E. UNIQUE - Valeurs distinctes",
        "syntaxe": "=UNIQUE(tableau; [par_colonne]; [exactement_une_fois])",
        "arguments": [
          "tableau : donn√©es source",
          "par_colonne : FAUX=unique par lignes (d√©faut), VRAI=par colonnes",
          "exactement_une_fois : FAUX=toutes uniques (d√©faut), VRAI=seulement celles qui apparaissent 1 fois"
        ],
        "exemple": "=UNIQUE(C2:C13) ‚Üí liste des r√©gions sans doublons"
      },
      {
        "phase": "F. Combiner les fonctions",
        "cas_1": {
          "description": "Clients Paris tri√©s par CA d√©croissant",
          "formule": "=SORT(FILTER(A2:F13;C2:C13=\"Paris\");5;-1)"
        },
        "cas_2": {
          "description": "Top 3 clients toutes r√©gions",
          "formule": "=TAKE(SORT(A2:F13;5;-1);3)"
        },
        "cas_3": {
          "description": "Clients Premium avec CA > 100k",
          "formule": "=FILTER(A2:F13;(D2:D13=\"Premium\")*(E2:E13>100000))"
        }
      }
    ],
  
    "checkpoints": [
      {
        "id": "cp_1_filter_paris",
        "cellule": "I2",
        "type": "formule",
        "description": "FILTER clients de Paris",
        "competence_id": 39,
        "fonction": "FILTER",
        "pattern": ["FILTER", "Paris"],
        "points": 15,
        "indices": [
          "=FILTER(tableau; condition)",
          "Condition : colonne C = \"Paris\"",
          "=FILTER(A2:F13;C2:C13=\"Paris\")"
        ]
      },
      {
        "id": "cp_2_filter_resultat",
        "cellule": "I2",
        "type": "valeur",
        "description": "Premier client Paris filtr√© (ID)",
        "competence_id": 39,
        "expected_value": "CL001",
        "points": 10,
        "indices": [
          "Dupont Sport est le premier client de Paris",
          "V√©rifie que ton filtre renvoie les bonnes lignes",
          "4 clients √† Paris au total"
        ]
      },
      {
        "id": "cp_3_filter_count",
        "type": "count",
        "zone_debut": "I2",
        "description": "Nombre de clients Paris (4 lignes)",
        "competence_id": 39,
        "expected_count": 4,
        "points": 10,
        "indices": [
          "Il y a 4 clients √† Paris",
          "Dupont, RunParis, GymTonic, ParisGym",
          "Le tableau doit s'√©tendre sur 4 lignes"
        ]
      },
      {
        "id": "cp_4_sort_ca",
        "cellule": "I18",
        "type": "formule",
        "description": "SORT par CA d√©croissant",
        "competence_id": 39,
        "fonction": "SORT",
        "pattern": ["SORT", "-1"],
        "points": 15,
        "indices": [
          "=SORT(tableau; colonne; ordre)",
          "Colonne CA = 5√®me colonne",
          "=SORT(A2:F13;5;-1) ‚Üí -1 pour d√©croissant"
        ]
      },
      {
        "id": "cp_5_sort_premier",
        "cellule": "I18",
        "type": "valeur",
        "description": "Client avec plus gros CA en premier",
        "competence_id": 39,
        "expected_value": "CL001",
        "points": 10,
        "indices": [
          "Dupont Sport a le plus gros CA (125000‚Ç¨)",
          "Il doit appara√Ætre en premier apr√®s le tri",
          "V√©rifie l'ordre d√©croissant"
        ]
      },
      {
        "id": "cp_6_unique_regions",
        "cellule": "I26",
        "type": "formule",
        "description": "UNIQUE liste des r√©gions",
        "competence_id": 39,
        "fonction": "UNIQUE",
        "pattern": ["UNIQUE"],
        "points": 15,
        "indices": [
          "=UNIQUE(colonne_regions)",
          "=UNIQUE(C2:C13)",
          "Doit renvoyer 4 r√©gions uniques"
        ]
      },
      {
        "id": "cp_7_combine_filter_sort",
        "cellule": "I32",
        "type": "formule",
        "description": "Combinaison FILTER + SORT",
        "competence_id": 29,
        "pattern": ["SORT", "FILTER"],
        "points": 25,
        "indices": [
          "Imbrique FILTER dans SORT",
          "=SORT(FILTER(...);colonne;ordre)",
          "=SORT(FILTER(A2:F13;C2:C13=\"Paris\");5;-1)"
        ]
      }
    ],
  
    "operateurs_matriciels": {
      "et_logique": {
        "syntaxe": "(condition1)*(condition2)",
        "exemple": "=FILTER(A:F;(C:C=\"Paris\")*(E:E>50000))",
        "note": "Les deux conditions doivent √™tre vraies"
      },
      "ou_logique": {
        "syntaxe": "(condition1)+(condition2)",
        "exemple": "=FILTER(A:F;(C:C=\"Paris\")+(C:C=\"Lyon\"))",
        "note": "Au moins une condition vraie"
      }
    },
  
    "fonctions_complementaires": [
      {
        "fonction": "TAKE(tableau;n)",
        "description": "Prend les n premi√®res lignes",
        "exemple": "=TAKE(SORT(A:F;5;-1);3) ‚Üí Top 3"
      },
      {
        "fonction": "DROP(tableau;n)",
        "description": "Supprime les n premi√®res lignes",
        "exemple": "=DROP(A2:F13;2) ‚Üí Sans les 2 premi√®res"
      },
      {
        "fonction": "CHOOSECOLS(tableau;cols)",
        "description": "S√©lectionne certaines colonnes",
        "exemple": "=CHOOSECOLS(A:F;1;2;5) ‚Üí Colonnes 1, 2 et 5"
      },
      {
        "fonction": "CHOOSEROWS(tableau;rows)",
        "description": "S√©lectionne certaines lignes",
        "exemple": "=CHOOSEROWS(A:F;1;3;5) ‚Üí Lignes 1, 3 et 5"
      }
    ],
  
    "erreurs_frequentes": [
      {
        "erreur": "#D√âBORDEMENT! (#SPILL!)",
        "cause": "Les cellules de d√©bordement contiennent d√©j√† des donn√©es",
        "solution": "Vide les cellules o√π le tableau doit s'√©tendre"
      },
      {
        "erreur": "Crit√®res multiples ne fonctionnent pas",
        "cause": "Utilisation de ET() au lieu de la multiplication",
        "solution": "Utilise (cond1)*(cond2) et non ET(cond1;cond2)"
      },
      {
        "erreur": "FILTER renvoie toutes les lignes",
        "cause": "Condition toujours vraie",
        "solution": "V√©rifie que ta condition compare la bonne plage"
      }
    ],
  
    "scoring": {
      "total_points": 100,
      "seuil_reussite": 70,
      "seuil_maitrise": 90
    },
  
    "feedback_manager": {
      "succes": "Impressionnant ! Tu ma√Ætrises les formules matricielles dynamiques. FILTER, SORT, UNIQUE... tu peux cr√©er des dashboards qui s'actualisent automatiquement ! üéâ",
      "partiel": "Tu as compris les bases. Les formules matricielles sont puissantes mais demandent de la pratique. Attention aux crit√®res multiples : utilise * pour ET, + pour OU.",
      "echec": "Les formules matricielles sont le niveau expert d'Excel. Reprends FILTER d'abord, puis SORT, puis combine-les progressivement."
    },
  
    "socrate_message": {
      "intro": "Les formules matricielles, c'est la r√©volution Excel 365 ! üöÄ Une seule formule qui cr√©e tout un tableau, filtr√©, tri√©, sans doublons... Magie !",
      "conclusion": "Tu as atteint le niveau expert Excel ! FILTER+SORT+UNIQUE = des dashboards dynamiques sans VBA, sans tableaux crois√©s. Le graal de l'analyste ! üèÜ"
    },
  
    "metadata": {
      "version": "1.0",
      "created_at": "2026-01-21",
      "tags": ["formules matricielles", "FILTER", "SORT", "UNIQUE", "Excel 365", "avanc√©", "tableaux dynamiques"],
      "prerequis": ["INDEX+EQUIV", "RECHERCHEX", "Fonctions logiques"],
      "ouvre_vers": ["LET", "LAMBDA", "Power Query"]
    }
  }