{
  "id": "mfc_25_04_formule_ligne",
  "version": "1.0",
  "titre": "üßÆ MFC avanc√©e : formule pour colorer toute la ligne",

  "metadata": {
    "niveau": "avance",
    "duree_estimee": "15 min",
    "competences_ids": [25],
    "competences_noms": ["MFC avanc√©e"],
    "prerequis": [10, 9],
    "objectif_pedagogique": "Cr√©er une r√®gle MFC bas√©e sur une formule personnalis√©e pour colorer une ligne enti√®re",
    "source_pdf": "Chapter 27: Conditional formatting - Section 27.1 (xlExpression)",
    "requires_screenshot": true
  },

  "contexte": {
    "situation": "Tu g√®res l'inventaire d'un entrep√¥t. Tu veux que toute la ligne d'un produit passe en rouge si son stock est inf√©rieur au seuil de r√©approvisionnement.",
    
    "personnage": "Toi, gestionnaire de stock.",
    
    "objectif": "Colorer automatiquement toute la ligne (produit + stock + seuil) quand Stock < Seuil.",
    
    "motivation": "La formule MFC permet de cr√©er des r√®gles ultra-personnalis√©es impossibles avec les r√®gles pr√©d√©finies.",
    
    "ton": "On passe au niveau expert ! Les formules MFC, c'est le Graal de la mise en forme."
  },

  "histoire_des_donnees": {
    "description": "Inventaire avec niveaux de stock et seuils d'alerte personnalis√©s par produit.",
    "periode": "Stock au 20/01/2025",
    "source_fictive": "WMS Entrep√¥t"
  },

  "donnees": {
    "headers": ["Produit", "Stock actuel", "Seuil alerte"],
    "rows": [
      ["√âcran 24\"", 45, 20],
      ["Clavier sans fil", 8, 15],
      ["Souris optique", 62, 30],
      ["Casque audio", 12, 25],
      ["Webcam HD", 5, 10],
      ["Hub USB", 28, 20],
      ["C√¢ble HDMI", 3, 15],
      ["Tapis souris", 89, 40]
    ],
    "placement": {
      "start_cell": "A1",
      "headers_row": 1
    }
  },

  "etapes": [
    {
      "numero": 1,
      "titre": "S√©lectionner toute la plage de donn√©es",
      "consigne": "S√©lectionne A2:C9 (toutes les lignes de donn√©es, pas les en-t√™tes).",
      "aide_contextuelle": "On s√©lectionne toute la zone car on veut colorer des lignes enti√®res.",
      "temps": "1 min"
    },
    {
      "numero": 2,
      "titre": "Ouvrir le gestionnaire de r√®gles",
      "consigne": "Accueil > MFC > Nouvelle r√®gle... > 'Utiliser une formule pour...'",
      "aide_contextuelle": "C'est la derni√®re option dans la liste des types de r√®gles.",
      "temps": "1 min"
    },
    {
      "numero": 3,
      "titre": "√âcrire la formule",
      "description": "La formule doit comparer Stock (B) avec Seuil (C) pour la ligne courante.",
      "consigne": "Dans le champ formule, tape : =$B2<$C2",
      "aide_contextuelle": "Le $ devant B et C fige les colonnes. Sans $ devant 2, la ligne s'adapte. C'est la cl√© !",
      "temps": "3 min"
    },
    {
      "numero": 4,
      "titre": "D√©finir le format",
      "consigne": "Clique sur 'Format...' > Remplissage > Rouge clair.",
      "temps": "1 min"
    },
    {
      "numero": 5,
      "titre": "V√©rifier le r√©sultat",
      "description": "Les produits en rupture imminente doivent avoir toute leur ligne en rouge.",
      "consigne": "V√©rifie que Clavier (8<15), Casque (12<25), Webcam (5<10) et C√¢ble (3<15) ont leur ligne compl√®te en rouge.",
      "aide_contextuelle": "4 produits sur 8 ont Stock < Seuil.",
      "temps": "2 min"
    }
  ],

  "zone_travail": {
    "description": "MFC formule sur toute la zone de donn√©es",
    "structure": [
      { "cellule": "A1:C9", "label": "Donn√©es", "style": "data" },
      { "cellule": "A2:C9", "label": "Zone MFC", "style": "mfc_zone" }
    ]
  },

  "checkpoints": [
    {
      "id": "cp_formula_1",
      "type": "format",
      "subtype": "mfc_formula",
      "description": "R√®gle bas√©e sur formule appliqu√©e",
      "competence_id": 25,
      "validation_type": "visual",
      "requires_screenshot": true,
      "expected": {
        "mfc_detected": true,
        "rule_type": "formula",
        "formula_contains": ["$B", "$C", "<"]
      },
      "points": 35,
      "indices": [
        "La formule doit √™tre =$B2<$C2 (avec les $ devant B et C).",
        "Le $ fige la colonne, le 2 sans $ permet √† la ligne de s'adapter.",
        "Sans les $, la r√®gle ne fonctionnera pas correctement sur toutes les lignes."
      ],
      "erreurs_probables": [
        { "type": "wrong_formula", "message": "La formule n'est pas correcte. Elle doit comparer $B2 avec $C2." },
        { "type": "missing_dollar", "message": "Il manque les $ devant B et C. La formule doit √™tre =$B2<$C2." },
        { "type": "absolute_row", "message": "Tu as mis $B$2 (ligne fig√©e). Utilise $B2 pour que la ligne s'adapte." }
      ]
    },
    {
      "id": "cp_formula_2",
      "type": "format",
      "subtype": "mfc_row_coloring",
      "description": "Lignes enti√®res color√©es (pas juste une cellule)",
      "competence_id": 25,
      "validation_type": "visual",
      "requires_screenshot": true,
      "expected": {
        "applies_to_row": true,
        "colored_columns": ["A", "B", "C"]
      },
      "points": 25,
      "indices": [
        "Toute la ligne doit √™tre rouge (colonnes A, B et C).",
        "Si seule la colonne B est rouge, tu as s√©lectionn√© B2:B9 au lieu de A2:C9.",
        "La s√©lection initiale d√©termine la zone d'application."
      ]
    },
    {
      "id": "cp_formula_3",
      "type": "format",
      "subtype": "mfc_coverage",
      "description": "4 lignes color√©es sur 8",
      "competence_id": 25,
      "validation_type": "visual",
      "requires_screenshot": true,
      "expected": {
        "colored_rows_count": 4,
        "colored_products": ["Clavier sans fil", "Casque audio", "Webcam HD", "C√¢ble HDMI"],
        "not_colored_products": ["√âcran 24\"", "Souris optique", "Hub USB", "Tapis souris"]
      },
      "points": 30,
      "indices": [
        "4 produits ont Stock < Seuil : Clavier (8<15), Casque (12<25), Webcam (5<10), C√¢ble (3<15).",
        "4 produits ont Stock >= Seuil et ne doivent PAS √™tre color√©s.",
        "√âcran (45>=20), Souris (62>=30), Hub (28>=20), Tapis (89>=40) sont OK."
      ]
    },
    {
      "id": "cp_formula_4",
      "type": "format",
      "subtype": "mfc_color",
      "description": "Format rouge appliqu√©",
      "competence_id": 25,
      "validation_type": "visual",
      "requires_screenshot": true,
      "expected": {
        "fill_color": "red",
        "fill_color_variants": ["rouge", "red", "lightred"]
      },
      "points": 10
    }
  ],

  "solution_complete": {
    "description": "R√®gle formule =$B2<$C2 avec format rouge sur A2:C9. 4 lignes enti√®res sont color√©es.",
    "etapes_cles": [
      "S√©lection A2:C9",
      "MFC > Nouvelle r√®gle > Formule",
      "Formule : =$B2<$C2",
      "Format rouge"
    ]
  },

  "feedback_personnalise": {
    "parfait": "üéâ Bravo ! Tu ma√Ætrises les formules MFC. C'est une comp√©tence avanc√©e tr√®s recherch√©e !",
    "bien": "üëç Tr√®s bien ! La logique est bonne. V√©rifie que les lignes ENTI√àRES sont color√©es.",
    "ameliorer": "üßÆ Presque ! La formule doit √™tre =$B2<$C2 avec $ devant B et C uniquement.",
    "revoir": "üîÑ Recommence : s√©lectionne A2:C9, puis MFC > Nouvelle r√®gle > Formule > =$B2<$C2."
  },

  "pour_aller_plus_loin": [
    "Ajoute une 2√®me r√®gle : orange si Stock < Seuil*1.5 (alerte pr√©ventive).",
    "Utilise une formule plus complexe avec ET() ou OU().",
    "Applique sur un tableau de plusieurs centaines de lignes."
  ]
}
