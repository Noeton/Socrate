{
  "id": "tcd_35_06_champ_calcule",
  "version": "1.0",
  "titre": "üßÆ TCD : cr√©er un champ calcul√©",

  "metadata": {
    "niveau": "avance",
    "duree_estimee": "15 min",
    "competences_ids": [35],
    "competences_noms": ["Tableaux crois√©s dynamiques"],
    "prerequis": [35],
    "objectif_pedagogique": "Cr√©er un champ calcul√© pour ajouter des m√©triques d√©riv√©es au TCD",
    "source_pdf": "Chapter 13: Pivot Tables - calculated fields",
    "requires_screenshot": true
  },

  "contexte": {
    "situation": "Tu analyses les ventes avec CA et Co√ªts. Tu veux calculer la Marge directement dans le TCD sans modifier les donn√©es source.",
    
    "personnage": "Toi, analyste financier calculant la rentabilit√©.",
    
    "objectif": "Cr√©er un champ calcul√© 'Marge' = CA - Co√ªt dans le TCD.",
    
    "motivation": "Le champ calcul√© permet d'ajouter des KPIs d√©riv√©s sans toucher aux donn√©es brutes.",
    
    "ton": "Le champ calcul√©, c'est le niveau ninja du TCD !"
  },

  "histoire_des_donnees": {
    "description": "Ventes par produit avec CA et co√ªts pour calculer la marge.",
    "periode": "Q4 2024",
    "source_fictive": "Comptabilit√© analytique"
  },

  "donnees": {
    "headers": ["Produit", "CA (‚Ç¨)", "Co√ªt (‚Ç¨)"],
    "rows": [
      ["Laptop", 12000, 8400],
      ["Tablette", 6500, 4200],
      ["Smartphone", 9800, 5900],
      ["Accessoires", 2400, 960],
      ["Services", 3500, 1400]
    ],
    "placement": {
      "start_cell": "A1",
      "headers_row": 1
    }
  },

  "etapes": [
    {
      "numero": 1,
      "titre": "Cr√©er le TCD de base",
      "consigne": "Insertion > TCD > Nouvelle feuille. Mets 'Produit' en lignes, 'CA' et 'Co√ªt' en valeurs.",
      "temps": "3 min"
    },
    {
      "numero": 2,
      "titre": "Ouvrir l'outil Champ calcul√©",
      "consigne": "Clic dans le TCD > Onglet 'Analyse du tableau crois√©' > Champs, √©l√©ments et jeux > Champ calcul√©...",
      "aide_contextuelle": "L'onglet peut s'appeler 'Outils de tableau crois√©' selon ta version.",
      "temps": "2 min"
    },
    {
      "numero": 3,
      "titre": "Cr√©er le champ Marge",
      "description": "On d√©finit Marge = CA - Co√ªt.",
      "consigne": "Nom : 'Marge'. Formule : = CA - Co√ªt (double-clic sur CA et Co√ªt dans la liste pour les ins√©rer).",
      "aide_contextuelle": "Utilise les noms des champs, pas des r√©f√©rences cellules !",
      "temps": "3 min"
    },
    {
      "numero": 4,
      "titre": "Valider et v√©rifier",
      "consigne": "Clique 'Ajouter' puis 'OK'. La colonne 'Somme de Marge' appara√Æt dans le TCD.",
      "temps": "2 min"
    },
    {
      "numero": 5,
      "titre": "V√©rifier les valeurs",
      "consigne": "Laptop : Marge = 12000-8400 = 3600‚Ç¨. Services : Marge = 3500-1400 = 2100‚Ç¨.",
      "aide_contextuelle": "Total Marge = 13440‚Ç¨ = Total CA (34200) - Total Co√ªt (20860).",
      "temps": "2 min"
    }
  ],

  "checkpoints": [
    {
      "id": "cp_calc_1",
      "type": "pivot_table",
      "description": "Champ calcul√© 'Marge' cr√©√©",
      "competence_id": 35,
      "validation_type": "visual",
      "requires_screenshot": true,
      "expected": {
        "calculated_field": true,
        "field_name": "Marge",
        "formula_contains": ["CA", "Co√ªt", "-"]
      },
      "points": 40,
      "indices": [
        "Tu dois voir une colonne 'Somme de Marge' dans le TCD.",
        "Analyse du tableau crois√© > Champs, √©l√©ments > Champ calcul√©.",
        "La formule doit √™tre = CA - Co√ªt (utilise les noms des champs)."
      ],
      "erreurs_probables": [
        { "type": "no_calculated_field", "message": "Pas de champ calcul√© visible. As-tu cliqu√© 'Ajouter' puis 'OK' ?" },
        { "type": "wrong_formula", "message": "La formule n'est pas correcte. Utilise = CA - Co√ªt." }
      ]
    },
    {
      "id": "cp_calc_2",
      "type": "pivot_table",
      "description": "Valeurs de marge correctes",
      "competence_id": 35,
      "validation_type": "visual",
      "requires_screenshot": true,
      "expected": {
        "margin_values": {
          "Laptop": 3600,
          "Tablette": 2300,
          "Smartphone": 3900,
          "Accessoires": 1440,
          "Services": 2100
        },
        "total_margin": 13340
      },
      "points": 35,
      "indices": [
        "Marge = CA - Co√ªt pour chaque produit.",
        "Laptop : 12000 - 8400 = 3600‚Ç¨",
        "Total marge = 34200 - 20860 = 13340‚Ç¨"
      ]
    },
    {
      "id": "cp_calc_3",
      "type": "pivot_table",
      "description": "CA et Co√ªt aussi en valeurs",
      "competence_id": 35,
      "validation_type": "visual",
      "requires_screenshot": true,
      "expected": {
        "value_fields": ["Somme de CA", "Somme de Co√ªt", "Somme de Marge"]
      },
      "points": 15,
      "indices": [
        "Tu dois avoir 3 colonnes : CA, Co√ªt, Marge.",
        "Le champ calcul√© s'ajoute aux autres, il ne les remplace pas."
      ]
    },
    {
      "id": "cp_calc_4",
      "type": "pivot_table",
      "description": "Produit en lignes",
      "competence_id": 35,
      "validation_type": "visual",
      "requires_screenshot": true,
      "expected": {
        "row_fields": ["Produit"]
      },
      "points": 10
    }
  ],

  "solution_complete": {
    "description": "TCD avec Produit en lignes, CA/Co√ªt en valeurs, et champ calcul√© Marge = CA - Co√ªt.",
    "etapes_cles": [
      "Cr√©er TCD avec CA et Co√ªt",
      "Analyse > Champ calcul√©",
      "Nom: Marge, Formule: = CA - Co√ªt"
    ]
  },

  "feedback_personnalise": {
    "parfait": "üéâ Bravo ! Tu as cr√©√© un KPI d√©riv√© directement dans le TCD. Niveau expert atteint !",
    "bien": "üëç Bien ! Le champ calcul√© existe. V√©rifie les valeurs de marge.",
    "ameliorer": "üßÆ Presque ! La formule doit √™tre = CA - Co√ªt (avec les noms des champs).",
    "revoir": "üîÑ Analyse > Champs, √©l√©ments > Champ calcul√© > Nom: Marge, Formule: = CA - Co√ªt."
  }
}
